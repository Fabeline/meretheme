const getPaths=()=>document.querySelectorAll('[data-mt-type="path"]'),getEntranceDoor=()=>document.querySelector('[data-mt-type="entrance-door"]'),getGarden=()=>document.querySelector('[data-mt-type="garden"]'),getHouse=()=>document.querySelector('[data-mt-type="house"]'),getRoom=()=>document.querySelector('[data-mt-type="room"]'),isGarden=()=>!!getGarden(),isHouse=()=>!!getHouse(),isRoom=()=>!!getRoom();debounce=(e,t)=>{let o;return(...a)=>{clearTimeout(o),o=setTimeout((()=>e.apply(null,a)),t)}};const socialMedia=[{name:"facebook",url:"https://www.facebook.com/sharer/sharer.php?u=",icon:"fab fa-facebook",color:"#3b5998"},{name:"twitter",url:"https://twitter.com/intent/tweet?url=",icon:"fab fa-twitter",color:"#00acee"},{name:"linkedin",url:"https://www.linkedin.com/shareArticle?url=",icon:"fab fa-linkedin",color:"#0e76a8"},{name:"whatsapp",url:"https://api.whatsapp.com/send?text=",icon:"fab fa-whatsapp",color:"#25d366"},{name:"email",url:"mailto:?body=",icon:"fas fa-envelope",color:"#46555c"},{name:"pinterest",url:"https://pinterest.com/pin/create/button/?url=",icon:"fab fa-pinterest",color:"#bd081c"},{name:"reddit",url:"https://www.reddit.com/submit?url=",icon:"fab fa-reddit",color:"#ff4500"},{name:"telegram",url:"https://t.me/share/url?url=",icon:"fab fa-telegram",color:"#0088cc"},{name:"tumblr",url:"https://www.tumblr.com/widgets/share/tool/preview?canonicalUrl=",icon:"fab fa-tumblr",color:"#35465d"},{name:"discord",url:"https://discord.com/channels/@me",icon:"fab fa-discord",color:"#5865f2"},{name:"mastodon",url:"https://share.nuclino.com/",icon:"fab fa-mastodon",color:"#3088d4"}],setDarkMode=e=>{darkModeOn=e;const t=document.querySelector("html");darkModeOn?t.classList.remove("light-mode"):t.classList.add("light-mode");document.querySelectorAll("iframe").forEach((e=>{e.contentWindow.postMessage({type:"setDarkMode",value:darkModeOn},"*")}))},insertDarkModeButton=()=>{const e=document.querySelectorAll('[data-mt-button="dark-mode"]');if(e.length>0){const t=document.createElement("button");t.textContent="Toggle Dark Mode",t.onclick=()=>setDarkMode(!darkModeOn),e.forEach((e=>e.appendChild(t)))}},shouldLoadMarkdown=()=>document.querySelectorAll('[data-mt-markdown="true"]').length>0,shouldLoadPrism=()=>document.querySelectorAll('[data-mt-code="true"]').length>0,shouldLoadBootstrap=()=>document.querySelectorAll('[data-mt-include="bootstrap"]').length>0,shouldAddShare=()=>document.querySelectorAll('[data-mt-type="share"]').length>0,shouldLoadFontAwesome=()=>shouldAddShare()||document.querySelectorAll('[data-mt-include="font-awesome"]').length>0,includeStyle=(e,t)=>new Promise(((o,a)=>{if(document.querySelector(`link[href*="${e}"]`))o();else{const r=document.createElement("link");r.rel="stylesheet",r.href=t,document.head.appendChild(r),r.onload=()=>{o()},r.onerror=()=>{a(new Error(`Failed to load ${e}`))}}})),includeScript=(e,t,o)=>new Promise(((a,r)=>{if(t&&!document.querySelector(`script[src*="${e}"]`)){const t=document.createElement("script");t.src=o,t.onload=()=>{a()},t.onerror=()=>{r(new Error(`Failed to load ${e}`))},document.head.appendChild(t)}else a()})),highlightCode=()=>{window.Prism=window.Prism||{},window.Prism.manual=!0;document.querySelectorAll('[data-mt-code="true"]').forEach((e=>{const t=document.createElement("pre"),o=e.getAttribute("data-mt-code-lang");t.classList.add(`language-${o}`);const a=document.createElement("code");a.textContent=e.textContent,t.appendChild(a),e.parentNode.replaceChild(t,e),Prism.highlightElement(a)}))},convertMarkdownToHTML=()=>{const e=document.querySelectorAll('[data-mt-markdown="true"]');e&&(marked.setOptions({sanitize:!1}),e.forEach((e=>{let t=e.textContent;t=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),t=t.split("\n").map((e=>e.trimStart())).join("\n");const o=marked.parse(t);e.innerHTML=o})))},loadExternal=()=>{Promise.all([shouldLoadFontAwesome()&&includeStyle("font-awesome",fontAwesomeCDN),shouldLoadBootstrap()&&includeStyle("bootstrap",bootstrapCDN),shouldLoadMarkdown()&&includeScript("marked",(()=>"function"!=typeof window.marked),markedCDN),shouldLoadPrism()&&includeStyle("prism",prismStyleCDN),shouldLoadPrism()&&includeScript("prism",(()=>void 0===window.Prism),prismCodeCDN)]).then((()=>{shouldLoadMarkdown()&&convertMarkdownToHTML(),shouldLoadPrism()&&highlightCode(),shouldAddShare()&&updateShare(),showContent(),(isHouse()||isRoom())&&updateSize()})).catch((e=>{console.error("Error loading scripts:",e)}))},bootstrapCDN="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css",markedCDN="https://cdn.jsdelivr.net/npm/marked/marked.min.js",fontAwesomeCDN="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css",prismStyleCDN="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/themes/prism.min.css",prismCodeCDN="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/prism.min.js";let debugOn=!1,documentId="",darkModeOn=!0,roomInHouseId="";const getSelectedHouse=()=>{getId();let e="";return e=new URLSearchParams(window.location.search).get("page"),e||(e=documentId.replace("-house","").replace("-garden","").replace("-room","")),e||"home"},getIdFromElement=e=>{let t="";"house"===e.getAttribute("data-mt-type")?t="house":"garden"===e.getAttribute("data-mt-type")?t="garden":"room"===e.getAttribute("data-mt-type")&&(t="room");let o=e.getAttribute("src").split("/").pop().split(".")[0];return o+=`-${t}`,o},getId=()=>{const e=location.href.split("/");let t="",o=!1;e.forEach((e=>{o&&(t&&(t+="/"),t+=e),"houses"!==e&&"rooms"!==e||(o=!0)})),t=t.replace(".html",""),t+=isHouse()?"-house":isGarden()?"-garden":isRoom()?"-room":"",documentId=t},getBaseHouseUrl=()=>window.location.href.split("houses")[0].replace("index.html","").split("?")[0],getNewHouseUrl=(e,t=!1)=>{const o=getBaseHouseUrl();let a="",r="";if(e.includes("?")){const[t,o]=e.split("?");a=`houses/${t}.html`,r=`?${o}`}else a=`houses/${e}.html`;let n="";return n="file:"===window.location.protocol&&t?`?page=${e}`:`${o}${a}${r}`,n},loadHouse=e=>{debug("Loading house:",e),window.history.replaceState(null,null,getNewHouseUrl(e,!0));const t=getEntranceDoor();t.src=getNewHouseUrl(e),t.dataset.mtId=e,t.onload=()=>{t.contentWindow.postMessage({type:"setDarkMode",value:darkModeOn},"*")}},loadRooms=()=>{document.querySelectorAll('[data-mt-type="room"]').forEach((e=>{e.contentWindow.postMessage({type:"updateHouseUrl",id:getPageUrl()},"*")}))},registerRoom=()=>{registerSizeUpdater()},getElementHeight=e=>{const t=window.getComputedStyle(e);return e.offsetHeight+parseInt(t.marginTop)+parseInt(t.marginBottom)},activateLinks=()=>{getPaths().forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),houseId=getIdFromLink(e),loadHouse(houseId),debug("Link clicked:",houseId),setCurrentLink(),updateShare()}))}))},activateInternalLinks=()=>{getPaths().forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const o=getIdFromLink(e);setCurrentLink(),window.top.postMessage({type:"updateEntranceDoor",id:o},"*"),updateShare(),debug("internal link  clicked:",o)}))}))},setCurrentLink=()=>{getPaths().forEach((e=>{getIdFromLink(e)===getSelectedHouse()||getSelectedHouse().indexOf(`${getIdFromLink(e)}/`)>-1?e.classList.add("active"):e.classList.remove("active")}))},getIdFromLink=e=>{const t=e.getAttribute("href");let o="home";return"index.html"!==t&&(o=t.replace(".html","").replace("houses/","").replaceAll("../","")),o},updateSize=()=>{id=documentId;const e=document.querySelector("html"),t=getElementHeight(e);window.parent.postMessage({type:"resizeElement",componentType:isHouse()?"house":"room",id:id,value:t},"*")},registerSizeUpdater=()=>{debug("Resize updater registered",documentId),window.addEventListener("resize",debounce(updateSize,100))},debug=(...e)=>{debugOn&&console.log(...e)},redirectHouse=()=>{if(isTopmostIframe()){const e=window.location.search,t="../".repeat((documentId.match(/\//g)||[]).length+1).split("?")[0];window.location.href=`${t}index.html?page=${documentId.replace("-house","")}${e}`}};window.onmessage=e=>{if("resizeElement"===e.data.type){if("house"===e.data.componentType&&isGarden()){getEntranceDoor().height=`${e.data.value}px`;document.querySelectorAll("iframe").forEach((t=>{t.contentWindow.postMessage({type:"afterResize",componentType:"house",id:e.data.id},"*")}))}else if("room"===e.data.componentType){document.querySelectorAll('[data-mt-type="room"]').forEach((t=>{getIdFromElement(t)===e.data.id&&(t.height=`${e.data.value}px`)})),updateSize()}}else if("updateEntranceDoor"===e.data.type){getEntranceDoor().src=`${getBaseHouseUrl()}/houses/${e.data.id}.html`,window.history.replaceState(null,null,getNewHouseUrl(e.data.id,!0)),setCurrentLink(),updateShare()}else if("updateTitle"===e.data.type){const t=document.querySelector("title");t&&(t.textContent=e.data.value)}else"setDarkMode"===e.data.type?setDarkMode(e.data.value):"updateHouseUrl"===e.data.type&&(roomInHouseId=e.data.id)};const updateTitle=()=>{const e=document.querySelector("title");e&&window.top.postMessage({type:"updateTitle",value:e.textContent},"*")},isTopmostIframe=()=>window===window.top,hideContent=()=>{document.body.style.opacity=0},showContent=()=>{document.body.style.opacity=1},getPageUrl=()=>isHouse()?window.location.href:isGarden()?getEntranceDoor().src:isRoom()?roomInHouseId:(console.warn("Unknown page type"),window.location.href),updateShare=()=>{document.querySelectorAll('[data-mt-type="share"]').forEach((e=>{const t=(e?.dataset?.mtTranslations||"").split(",");let o=0;const a=e?.dataset?.mtValue?.replaceAll(", ",",").split(",")||socialMedia.map((e=>e.name));for(;e.firstChild;)e.removeChild(e.firstChild);a.forEach((a=>{const r=socialMedia.find((e=>e.name===a));if(!r)return void console.warn("Media not found:",a);const n=t.length>0&&t[o]?.trimStart()||r.name,d=document.createElement("a");d.classList.add("media-share"),d.href=r.url+getPageUrl(),d.target="_blank",d.style.backgroundColor=r.color,d.style.textDecoration="none",d.innerHTML=`<i aria-label="${n}" style="${r.color}" class="${r.icon}"></i>`,e.appendChild(d),o++}))}))},houseShouldBeRedirected=()=>isHouse()&&isTopmostIframe(),start=()=>{getId(),isGarden()?(debug("Found garden"),loadHouse(getSelectedHouse()),setCurrentLink(),activateLinks()):isHouse()?(debug("Found house",documentId),houseShouldBeRedirected()?redirectHouse():(loadRooms(),updateTitle())):isRoom()&&debug("Found room",documentId),houseShouldBeRedirected()||(hideContent(),loadExternal(),insertDarkModeButton(),(isHouse()||isRoom())&&(registerSizeUpdater(),activateInternalLinks()))};start();